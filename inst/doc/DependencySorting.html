<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="John Mount" />

<meta name="date" content="2018-06-23" />

<title>Join Dependency Sorting</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Join Dependency Sorting</h1>
<h4 class="author"><em>John Mount</em></h4>
<h4 class="date"><em>2018-06-23</em></h4>



<p>Let’s discuss the task of left joining many tables from a data warehouse using <a href="https://www.r-project.org"><code>R</code></a> and a system called “a join controller” (last discussed <a href="http://www.win-vector.com/blog/2017/06/use-a-join-controller-to-document-your-work/">here</a>).</p>
<p>One of the great advantages to specifying complicated sequences of operations in data (rather than in code) is: it is often easier to transform and extend data. Explicit rich data beats vague convention and complicated code.</p>
<p>For example suppose we have a <code>dplyr</code> <code>RSQLite</code> database handle in the variable <code>my_db</code> and we are using the following names for our tables in this database (keep in mind <code>replyr</code> allows different abstract and concrete table names, for this example we will assume they are the same):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tableNames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'employeeanddate'</span>,
                <span class="st">'revenue'</span>,
                <span class="st">'activity'</span>,
                <span class="st">'orgtable'</span>)</code></pre></div>
<p>We can now use <code>replyr::tableDescription()</code> to get descriptions of these tables <em>including</em> any declared primary key structure.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>))
<span class="kw">library</span>(<span class="st">&quot;replyr&quot;</span>)</code></pre></div>
<pre><code>## Loading required package: wrapr</code></pre>
<pre><code>## 
## Attaching package: 'wrapr'</code></pre>
<pre><code>## The following object is masked from 'package:dplyr':
## 
##     coalesce</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tDesc &lt;-<span class="st"> </span>tableNames <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">lapply</span>(
    <span class="cf">function</span>(ni) {
      replyr<span class="op">::</span><span class="kw">tableDescription</span>(ni,
                               dplyr<span class="op">::</span><span class="kw">tbl</span>(my_db, ni),
                               <span class="dt">keyInspector=</span> key_inspector_sqlite)
    }) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bind_rows</span>()

<span class="kw">print</span>(tDesc[, <span class="kw">c</span>(<span class="st">'tableName'</span>, <span class="st">'handle'</span>, <span class="st">'keys'</span>, <span class="st">'columns'</span>), ])</code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   tableName       handle        keys      columns  
##   &lt;chr&gt;           &lt;list&gt;        &lt;list&gt;    &lt;list&gt;   
## 1 employeeanddate &lt;S3: tbl_dbi&gt; &lt;chr [0]&gt; &lt;chr [2]&gt;
## 2 revenue         &lt;S3: tbl_dbi&gt; &lt;chr [2]&gt; &lt;chr [3]&gt;
## 3 activity        &lt;S3: tbl_dbi&gt; &lt;chr [2]&gt; &lt;chr [4]&gt;
## 4 orgtable        &lt;S3: tbl_dbi&gt; &lt;chr [2]&gt; &lt;chr [4]&gt;</code></pre>
<p>This is more legible if we turn it into a column join plan.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">columnJoinPlan &lt;-<span class="st"> </span><span class="kw">buildJoinPlan</span>(tDesc, <span class="dt">check=</span> <span class="ot">FALSE</span>)
<span class="kw">print</span>(columnJoinPlan[, <span class="kw">c</span>(<span class="st">'tableName'</span>, <span class="st">'sourceColumn'</span>, <span class="st">'resultColumn'</span>, <span class="st">'isKey'</span>)])</code></pre></div>
<pre><code>## # A tibble: 13 x 4
##    tableName       sourceColumn resultColumn      isKey
##    &lt;chr&gt;           &lt;chr&gt;        &lt;chr&gt;             &lt;lgl&gt;
##  1 employeeanddate id           id                FALSE
##  2 employeeanddate date         date              FALSE
##  3 revenue         date         date              TRUE 
##  4 revenue         dept         dept              TRUE 
##  5 revenue         rev          rev               FALSE
##  6 activity        eid          eid               TRUE 
##  7 activity        date         date              TRUE 
##  8 activity        hours        hours             FALSE
##  9 activity        location     activity_location FALSE
## 10 orgtable        eid          eid               TRUE 
## 11 orgtable        date         date              TRUE 
## 12 orgtable        dept         dept              FALSE
## 13 orgtable        location     orgtable_location FALSE</code></pre>
<p>At this point we are <em>almost</em> ready to execute a left join plan on these four tables (as detailed in <code>vignette('joinController', package= 'replyr')</code>). What we need to do is:</p>
<ul>
<li>Regularize the key structure of the tables. In our example the analyst would have the domain knowledge that the <code>id</code> column in the <code>employeeanddate</code> table is an “employee id” and mean to match the <code>eid</code> columns in other tables.</li>
<li>Specify a left-most or controlling table for the analysis. In this case it is <code>employeeanddate</code> which we assume the analyst created through a join or cross-product of an employee list and set of dates. The left most table represents the experimental design or the exact set of row if the other tables are uniquely keyed (which can be confirmed with <code>replyr:keysAreUnique()</code>). The left join outcome depends on rows and values in the left most table, and not on its declared key structure (that is why we do not care that the <code>employeeanddate</code> has no declared keys, which is common for derived tables).</li>
<li>Find an ordering of the rest of the tables that makes the left join executable or realizable (more on this later).</li>
</ul>
<p>First let’s patch up the key structure. This could be done by exporting the <code>columnJoinPlan</code> as a spreadsheet and editing it, but for our example we will just alter it in place.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">columnJoinPlan<span class="op">$</span>resultColumn[columnJoinPlan<span class="op">$</span>sourceColumn<span class="op">==</span><span class="st">'id'</span>] &lt;-<span class="st"> 'eid'</span>
<span class="kw">print</span>(columnJoinPlan[, <span class="kw">c</span>(<span class="st">'tableName'</span>, <span class="st">'sourceColumn'</span>, <span class="st">'resultColumn'</span>, <span class="st">'isKey'</span>)])</code></pre></div>
<pre><code>## # A tibble: 13 x 4
##    tableName       sourceColumn resultColumn      isKey
##    &lt;chr&gt;           &lt;chr&gt;        &lt;chr&gt;             &lt;lgl&gt;
##  1 employeeanddate id           eid               FALSE
##  2 employeeanddate date         date              FALSE
##  3 revenue         date         date              TRUE 
##  4 revenue         dept         dept              TRUE 
##  5 revenue         rev          rev               FALSE
##  6 activity        eid          eid               TRUE 
##  7 activity        date         date              TRUE 
##  8 activity        hours        hours             FALSE
##  9 activity        location     activity_location FALSE
## 10 orgtable        eid          eid               TRUE 
## 11 orgtable        date         date              TRUE 
## 12 orgtable        dept         dept              FALSE
## 13 orgtable        location     orgtable_location FALSE</code></pre>
<p>Now we can worry about left join order.</p>
<p>The most important choice in a left join plan is which table is left-most. If all the other tables are addressed by primary keys (i.e., there is not more than one row matching any row of the left-table) then the left-most table completely determines the set of rows in the left join result, no matter how many tables we are joining in. The order the rest of the tables are joined becomes irrelevant assuming it is an order we can execute.</p>
<p>What prevents a proposed left join order from being executable is trying to join in a table that has a key that we do not yet have values for. Let’s show this as part of our example. Suppose we know that we want the table “<code>employeeanddate</code>” to be the left-most table in our left join sequence (and again, this is the one important choice). We can see our current left join plan (<code>columnJoinPlan</code>) is not executable in the order it is currently specifying:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;issues:&quot;</span>, <span class="kw">inspectDescrAndJoinPlan</span>(tDesc, columnJoinPlan)))</code></pre></div>
<pre><code>## [1] &quot;issues: key col(s) ( dept ) not contained in result cols of previous table(s) for table: revenue&quot;</code></pre>
<p>This message is saying: when it comes time to join in the “<code>revenue</code>” table rows do not yet have values for the “<code>dept</code>” key column (so we can’t do the join in that order).</p>
<p>The table to table conditions are well-defined if a few invariants and conventions are maintained in the <code>tDesc</code> table descriptions:</p>
<ul>
<li>Each <code>resultColumn</code> name can occur at most once with <code>isKey==FALSE</code>.</li>
<li><code>resultColumn</code> names with <code>isKey==TRUE</code> have the same interpretation in all tables (due to the ability to re-map names from <code>sourceColumn</code>).</li>
<li>The left-most table is treated as special in that it is “joinable” no matter what key constraints it does or does not declare and no other table can be joined before it.</li>
</ul>
<p>Since not all orders are valid left join plans the task is to find a re-ordering (if there is one) that is a valid left join plan. The requirement that each table’s keys have known values before we join gives us order relations on the tables (we know which tables must be joined before others). Finding an ordering that obeys all the relations is called “topological sorting” We can compute the join path dependencies <em>and</em> re-order the join plan to be realizable as follows (assuming the <code>igraph</code> package is available do perform the topological sorting and plot the directed relations).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sorted &lt;-<span class="st"> </span><span class="ot">NULL</span>
<span class="co"># requireNamespace checks just for strict warning hygiene in vignette</span>
<span class="cf">if</span>(<span class="kw">requireNamespace</span>(<span class="st">'igraph'</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)) {
  sorted &lt;-<span class="st"> </span><span class="kw">topoSortTables</span>(columnJoinPlan, <span class="st">'employeeanddate'</span>)
  <span class="kw">plot</span>(sorted<span class="op">$</span>dependencyGraph)
  <span class="kw">print</span>(sorted<span class="op">$</span>tableOrder)
}</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<pre><code>## [1] &quot;employeeanddate&quot; &quot;activity&quot;        &quot;orgtable&quot;        &quot;revenue&quot;</code></pre>
<p>In the above graph a table can only be joined after all of the tables pointing to it have been joined. See that this captures that the “<code>revenue</code>” table must be joined after the “<code>orgtable</code>” (as “<code>orgtable</code>” is our mapping from employees to departments). We could work on the legibility of the above graph using <code>igraph</code> controls, but I feel that it is just as well to move on to the detailed <code>DiagrammeR</code> based left join diagrams.</p>
<p>And (again assuming we have the <code>igraph</code> package), we have a new <code>sorted$columnJoinPlan</code> that passes checks:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(sorted)) {
  <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;issues:&quot;</span>, <span class="kw">inspectDescrAndJoinPlan</span>(tDesc, 
                                                 sorted<span class="op">$</span>columnJoinPlan)))
}</code></pre></div>
<pre><code>## [1] &quot;issues: &quot;</code></pre>
<p>The new <code>sorted$columnJoinPlan</code> can be re-plotted as follows:</p>
<pre><code>sorted$columnJoinPlan %&gt;%
        makeJoinDiagramSpec(.) %&gt;%
        DiagrammeR::grViz(.)</code></pre>
<p>And the new <code>sorted$columnJoinPlan</code> is ready to be executed:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(sorted)) {
  <span class="kw">print</span>(<span class="st">&quot;join plan execution log&quot;</span>)
  res &lt;-<span class="st"> </span><span class="kw">executeLeftJoinPlan</span>(tDesc, 
                             sorted<span class="op">$</span>columnJoinPlan,
                             <span class="dt">verbose =</span> <span class="ot">TRUE</span>)
  <span class="kw">print</span>(<span class="st">&quot;join results&quot;</span>)
  dplyr<span class="op">::</span><span class="kw">glimpse</span>(res)
}</code></pre></div>
<pre><code>## [1] &quot;join plan execution log&quot;
## [1] &quot;start employeeanddate Sat Jun 23 11:01:28 2018&quot;
## [1] &quot; rename/restrict employeeanddate&quot;
## [1] &quot;   'eid' = 'id'&quot;
## [1] &quot;   'date' = 'date'&quot;
## [1] &quot; res &lt;- employeeanddate&quot;
## [1] &quot;done employeeanddate Sat Jun 23 11:01:29 2018&quot;
## [1] &quot;start activity Sat Jun 23 11:01:29 2018&quot;
## [1] &quot; rename/restrict activity&quot;
## [1] &quot;   'table_activity_present' = 'table_activity_present'&quot;
## [1] &quot;   'eid' = 'eid'&quot;
## [1] &quot;   'date' = 'date'&quot;
## [1] &quot;   'hours' = 'hours'&quot;
## [1] &quot;   'activity_location' = 'location'&quot;
## [1] &quot; res &lt;- left_join(res, activity,&quot;
## [1] &quot;                  by = c( 'eid', 'date' ))&quot;
## [1] &quot;done activity Sat Jun 23 11:01:29 2018&quot;
## [1] &quot;start orgtable Sat Jun 23 11:01:29 2018&quot;
## [1] &quot; rename/restrict orgtable&quot;
## [1] &quot;   'table_orgtable_present' = 'table_orgtable_present'&quot;
## [1] &quot;   'eid' = 'eid'&quot;
## [1] &quot;   'date' = 'date'&quot;
## [1] &quot;   'dept' = 'dept'&quot;
## [1] &quot;   'orgtable_location' = 'location'&quot;
## [1] &quot; res &lt;- left_join(res, orgtable,&quot;
## [1] &quot;                  by = c( 'eid', 'date' ))&quot;
## [1] &quot;done orgtable Sat Jun 23 11:01:29 2018&quot;
## [1] &quot;start revenue Sat Jun 23 11:01:29 2018&quot;
## [1] &quot; rename/restrict revenue&quot;
## [1] &quot;   'table_revenue_present' = 'table_revenue_present'&quot;
## [1] &quot;   'date' = 'date'&quot;
## [1] &quot;   'dept' = 'dept'&quot;
## [1] &quot;   'rev' = 'rev'&quot;
## [1] &quot; res &lt;- left_join(res, revenue,&quot;
## [1] &quot;                  by = c( 'date', 'dept' ))&quot;
## [1] &quot;done revenue Sat Jun 23 11:01:29 2018&quot;
## [1] &quot;join results&quot;
## Observations: ??
## Variables: 10
## $ eid                    &lt;chr&gt; &quot;i4&quot;, &quot;i4&quot;
## $ date                   &lt;int&gt; 20140501, 20140601
## $ table_activity_present &lt;dbl&gt; 1, 1
## $ hours                  &lt;int&gt; 50, 3
## $ activity_location      &lt;chr&gt; &quot;office&quot;, &quot;client&quot;
## $ table_orgtable_present &lt;dbl&gt; 1, 1
## $ dept                   &lt;chr&gt; &quot;IT&quot;, &quot;SL&quot;
## $ orgtable_location      &lt;chr&gt; &quot;CA&quot;, &quot;TX&quot;
## $ table_revenue_present  &lt;dbl&gt; 0, 1
## $ rev                    &lt;int&gt; NA, 2000</code></pre>
<p>And this is how we use tools to do the heavy lifting in building a left join plan:</p>
<ul>
<li>The table descriptions can be largely built by <code>replyr::tableDescription()</code>.</li>
<li>The column names can be disambiguated by <code>replyr::buildJoinPlan()</code>.</li>
<li>The user can then export <code>columnJoinPlan</code> and refine the definition of table keys using an editor or spreadsheet software. This is key documentation that should be shared with other groups and kept under source-control.</li>
<li><code>replyr::topoSortTables()</code> can then reorder <code>columnJoinPlan</code> to bring the tables together in a realizable order.</li>
<li><code>replyr::makeJoinDiagramSpec() %&gt;% DiagrammeR::grViz(.)</code> can then produce and capture a detailed diagram of the final join plan.</li>
<li>Finally <code>replyr::executeLeftJoinPlan()</code> can execute the join plan with diagnostics.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DBI<span class="op">::</span><span class="kw">dbDisconnect</span>(my_db)</code></pre></div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
